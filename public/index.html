<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Email Signature Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
crossorigin="anonymous"/>


<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  body{
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #f8f9fa;
  padding: 10px;
  font-size: 15px;
  line-height: 1.6;
  color: #2c3e50;
}

.container{
  max-width: 1500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
}

h2{
  font-size: 28px;
  font-weight: 600;
  color: #1a1a1a;
  margin-bottom: 30px;
  letter-spacing: -0.5px;
}

label{
  font-weight: 500;
  font-size: 14px;
  color: #000;
  display: block;
  margin-bottom: 8px;
  letter-spacing: 0.2px;
}

input, textarea{
  width: 100%;
  padding: 12px 16px;
  margin: 0 0 20px;
  font-family: 'Inter', sans-serif;
  font-size: 15px;
  border: 1.5px solid #d0d5dd;
  border-radius: 8px;
  transition: all 0.2s ease;
  box-sizing: border-box;
}

input:focus, textarea:focus{
  outline: none;
  border-color: #00AE99;
  box-shadow: 0 0 0 3px rgba(0, 174, 153, 0.1);
}

input::placeholder, textarea::placeholder{
  color: #98a2b3;
  font-size: 14px;
}

button{
  background: #00AE99;
  color: #fff;
  border: none;
  padding: 14px 32px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s ease;
  font-family: 'Inter', sans-serif;
  letter-spacing: 0.3px;
}

button:hover{
  background: #009182;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 174, 153, 0.3);
}

button:active{
  transform: translateY(0);
}

#signatureWrapper{
  display: none;
}
.main-layout{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  align-items: flex-start;
}

.form-column{
  padding-right: 10px;
}

.preview-column{
  position: sticky;
  top: 20px;
  background: #fafafa;
  padding: 20px;
  border-radius: 10px;
  border: 1px solid #eee;
}

.preview-title{
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
}

/* Mobile fallback */
@media (max-width: 900px){
  .main-layout{
    grid-template-columns: 1fr;
  }

  .preview-column{
    position: static;
  }
}

</style>
</head>

<body>
<div class="container">

<h2>Email Signature Generator</h2>
<div class="main-layout" >

  <!-- LEFT: FORM -->
 <div class = "form-column">

<label>Profile Image <span style = "color:red">*</span></label>
<input type="file" id="img" accept="image/*" required>
<div id="uploadStatus" style="margin-top: 2px; margin-bottom: 15px; font-size: 13px;"></div>

<div id="jobTitleContainer" style="display: none;">
  <label>Job Title <span style="color:red">*</span></label>
  <input type="text" id="jobTitleInput" placeholder="Enter job title" style="width: 50%"/>
</div>

<!--
<div style = "display: flex; justify-content:flex-start">
<div >
  <label>Full Name <span style = "color:red">*</span></label>
<input type = "text" id="name" required style = "width: 300px;">
</div> 

<div style ="margin-left: 15px"> <label>Job Title <span style = "color:red">*</span></label>
<input type = "text" id="title" required style = "width: 300px;">
</div>


</div>
<input type="hidden" id="company" value="Team Enoch">

<div style = "display:flex;justify-content:flex-start;"> 
<div > 
  <label>Personal Phone <span style = "color:red">*</span></label>
<input
  type="tel"
  id="phone"
  placeholder="(123) 456-7890"
  maxlength="14"
  required
  pattern="\(\d{3}\) \d{3}-\d{4}"
  title="Phone number must be in the format (XXX) XXX-XXXX"
  oninput="formatPhone(this)"
  style = "width: 300px;"
>
</div>
<div style ="margin-left: 15px;"> 
<label>Email <span style = "color:red">*</span></label>
<input type = "email" id="email" placeholder="e.g., user@example.com" required style = "width: 300px;">
</div>
</div> -->

  <label>Email Address <span style="color:red">*</span></label>
<input type="email" id="email" placeholder="Enter your email address" required style="width: 100%;">


<button onclick="fetchUserData()" style="margin-top: 10px;">Generate Signature</button>

<div id="loadingStatus" style="margin-top: 15px; font-size: 14px; display: none;">
  <span style="color: #ff9800;">⏳ Fetching your information...</span>
</div>

<div id="errorStatus" style="margin-top: 15px; font-size: 14px; display: none; color: #f44336;">
  ✗ <span id="errorMessage"></span>
</div>
<br>
<hr style="margin:25px 0">

<h3 style="margin-bottom:10px;">Signature Customization</h3>

<div style="display:flex;"> 
  <!-- Font Size for Name -->
  <div> 
    <label>Font Size - Name (px)</label>
    <input 
      type="number" 
      id="fontSizeName" 
      value="14" 
      min="8" 
      max="32" 
      placeholder="14"
      style="width:200px; padding:10px; margin-bottom:10px;"
    >
  </div>

  <!-- Font Size for Phone/Contact -->
  <div style="margin-left: 40px;"> 
    <label>Font Size - Phone/Contact (px)</label>
    <input 
      type="number" 
      id="fontSizeContact" 
      value="12" 
      min="8" 
      max="24" 
      placeholder="12"
      style="width:200px; padding:10px; margin-bottom:10px;"
    >
  </div>
</div>

<div style="display:flex;"> 
  <!-- Font Color for Job Title -->
  <div> 
    <label>Font Color - Job Title</label>
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
      <input type="color" id="fontColorTitlePicker" value="#000000" style="width:50px; height:35px; cursor:pointer;">
      <input type="text" id="fontColorTitleText" value="#000000" placeholder="#000000" style="width:100px; font-family:monospace;">
    </div>
  </div>

  <!-- Font Color for Texas/Florida -->
  <div style="margin-left: 80px;"> 
    <label>Font Color - Texas/Florida</label>
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
      <input type="color" id="fontColorHeadingPicker" value="#000000" style="width:50px; height:35px; cursor:pointer;">
      <input type="text" id="fontColorHeadingText" value="#000000" placeholder="#000000" style="width:100px; font-family:monospace;">
    </div>
  </div>
</div>

<div style="display:flex;"> 
  <!-- Font Color for Profile (Name & Title) -->
  <div> 
    <label>Font Color - Profile</label>
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
      <input type="color" id="fontColorProfilePicker" value="#ffffff" style="width:50px; height:35px; cursor:pointer;">
      <input type="text" id="fontColorProfileText" value="#ffffff" placeholder="#ffffff" style="width:100px; font-family:monospace;">
    </div>
  </div>

  <!-- Font Color for Phone/Contact -->
  <div style="margin-left: 80px;"> 
    <label>Font Color - Phone/Contact</label>
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
      <input type="color" id="fontColorContactPicker" value="#ffffff" style="width:50px; height:35px; cursor:pointer;">
      <input type="text" id="fontColorContactText" value="#ffffff" placeholder="#ffffff" style="width:100px; font-family:monospace;">
    </div>
  </div>
</div>

<div style = "display: flex;"> 
  <!-- Card Background Color -->
 <div>
  <label>Card Color</label>
<div style="display:flex; gap:10px; margin-bottom:10px; align-items:center; width: 200px;">
  <input type="color" id="cardColorPicker" value="#1a1a1a" style="width:50px; height:35px; cursor:pointer;">
  <input type="text" id="cardColorText" value="#1a1a1a" placeholder="#000000" style="width:100px; font-family:monospace;">
 
</div>
 </div>  


<!-- Card Border Color -->
 <div style = "margin-left: 40px;"> 
  <label>Card Border Color</label>
<div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
  <input type="color" id="cardBorderPicker" value="#111111" style="width:50px; height:35px; cursor:pointer;">
  <input type="text" id="cardBorderText" value="#111111" placeholder="#000000" style="width:100px; font-family:monospace;">

</div>
 </div>

</div>

<hr style="margin:25px 0">

<h3 style="margin-bottom:4px;">Background</h3>
<div style = "display: grid;"> 
  <label style="display: inline-flex; align-items: center;">
  <input type="radio" name="bgType" value="color" checked style ="width: 30px;">
  Background Color
</label>

<label style="display: inline-flex; align-items: center;">
  <input type="radio" name="bgType" value="image" style ="width: 30px;">
  Background Image
</label>
</div>

<!-- Background color picker -->
<div id="bgColorControls">
  <label>Background Color</label>
  <div style="display:flex; gap:10px;">
    <input type="color" id="bgColorPicker" value="#737578" style ="width: 50px; height: 35px; cursor: pointer;">
    <input type="text" id="bgColorText" value="#737578" placeholder="#000000" style = "width: 100px; font-family: monospace;">
  </div>
</div>

<!-- Background image upload -->
<div id="bgImageControls" style="display:none;">
  <label>Upload Background Image</label>
  <input type="file" id="bgImageInput" accept="image/*">
  <div id="bgUploadStatus" style="margin-top: 5px; font-size: 13px;"></div>

</div>


</div>
<div class="preview-column">
  <div class="preview-title"> Signature Preview</div>
  <div id="signatureWrapper" style="display: block;">

<br>

<!-- ================= EXACT SIGNATURE ================= -->
<table style="max-width: 450px; margin: 0; border-collapse: collapse; font-family: Arial, sans-serif;">
    <tr>
        <td id="sigOuter" style="background-color: #737578 ;border-radius: 12px; padding: 5px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="vertical-align: middle; padding-right: 12px; width:280px; height:100% ">
                        <table id = "sigCard" style="background:rgba(1,1,1, 0.2); border-radius: 10px; border: 3px solid #111;padding: 15px; text-align: center; height: 100%;">
                            <tr>
                                <td>
                                    <img id="s_img" src="https://lh3.googleusercontent.com/d/19moIcxYpv6rC508rJyzF4CRe_vtR4Ej5" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.4); box-shadow: 0 3px 10px rgba(0,0,0,0.55); display: block; margin: 0 auto 12px;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                      <tr> <td id="s_name" nowrap style="font-size: 14px; font-weight: bold; color: #fff; margin-bottom: 5px; padding: 0;">Test Name</td> </tr>
                                  </table>
                                    <div style="font-size: 12px; color: #666; line-height: 1.4;"></div>
                                    <div id = "s_title" style="font-size: 12px; font-weight: bold; color: #000; margin-top: 10px; padding-top: 8px; border-top: 2px solid #000;">Job Title</div>
                                    <!-- Phone -->
                          <div style="margin-top: 8px;">
                            <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px;">
                            <a href="tel:+11234567890" style="color: white; font-size: 12px; text-decoration: none;" id="s_phone_card">(123) 456-7890</a>
                          </div>

                          <!-- Email -->
                         <!-- Email (icon + address on same line) -->
                            <table style="margin-top: 6px; border-collapse: collapse;">
                              <tr>
                                <td style="vertical-align: middle; padding-right: 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/new-post.png"
                                      width="14" height="14"
                                      alt="Email"
                                      style="display:block;">
                                </td>
                                <td style="vertical-align: middle;">
                                  <a href="mailto:email@example.com"
                                    id="s_email_card"
                                    style="color: white; font-size: 12px; text-decoration: none; white-space: nowrap;">
                                    email@example.com
                                  </a>
                                </td>
                              </tr>
                            </table>

                                </td>
                            </tr>
                        </table>
                    </td>
                    <td style="vertical-align: top; padding-right: 15px; width: 260px; text-align: center; ">
                        <img src="https://lh3.googleusercontent.com/d/1XQSCCts09YLonl2Qb9WZjInQoP_z84M1" style="max-width: 240px; max-height: 180px; display: block;margin: 0 auto; padding: 3px; border-radius: 8px; ">
                        <!-- Social Media Icons - Horizontal Layout -->
                        <div style="text-align: center; margin-top: 5px; margin-bottom: 10px;">
                            <a href="https://www.facebook.com/share/1B35sgfU69/" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/facebook-new.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block; filter: brightness(0) invert(1);">
                            </a>
                            <a href="https://www.instagram.com/team.enoch.dfw/?hl=en" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/instagram-new.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block;color: white; filter: brightness(0) invert(1);">
                            </a>
                            <a href="https://www.linkedin.com/company/enochelectric/posts/?feedView=all" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/linkedin.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block; filter: brightness(0) invert(1);">
                            </a>
                            <a href="https://www.youtube.com/@TeamEnoch" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/youtube-play.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block; filter: brightness(0) invert(1);">
                            </a>
                            <a href="https://www.tiktok.com/@teamenochhvac?_r=1&_t=ZS-92TQ8y9Zgxe" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/tiktok.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block; filter: brightness(0) invert(1);">
                            </a>
                            <a href="https://x.com/EnochTeam" target="_blank" style="display: inline-block; margin: 0 6px;">
                                  <img src="https://img.icons8.com/ios-filled/20/000000/twitter.png
                                    " width="18" height="18" alt="Facebook" style="vertical-align:middle; margin-right:4px; border:0; display:inline-block; filter: brightness(0) invert(1);">
                            </a>
                        </div>
                       <div >
                          <table style="width:100%; border-collapse: collapse;text-align:left;">
                            <tr>
                              <!-- TEXAS COLUMN -->
                              <td style="vertical-align: top; padding-right: 12px;">
                                <div id="texasHeading" style="color:#000; font-weight:bold; font-size:18px; margin-bottom:6px;">
                                  Texas
                                </div>
                               <div style="margin-top:4px; display:flex; align-items:flex-start; white-space:nowrap;">
  <img src="https://img.icons8.com/ios-filled/20/ffffff/marker.png" width="14" height="14" alt="Location" style="margin-right:2px; border:0; margin-top:2px;">
  <div style="display:flex; flex-direction:column;">
    <a href="https://www.google.com/maps/place/Team+Enoch:+Electric,+Plumbing,+Air,+Roofing/@32.763454,-97.1586546,17z/..." target="_blank" style="color:white; font-size:12px; text-decoration:none;">
      8940 Creek Run Rd,
    </a>
    <a href="https://www.google.com/maps/place/Team+Enoch:+Electric,+Plumbing,+Air,+Roofing/@32.763454,-97.1586546,17z/..." target="_blank" style="color:white; font-size:12px; text-decoration:none;">
      Fort Worth, 76120
    </a>
  </div>
</div>


                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+18178888880" style="color:white; font-size:12px; text-decoration:none;">
                                    DFW: (817) 888-8880
                                  </a>
                                </div>

                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+15128828880" style="color:white; font-size:12px; text-decoration:none;">
                                    Austin: (512) 882-8880
                                  </a>
                                </div>

                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+17135001000" style="color:white; font-size:12px; text-decoration:none;">
                                    Houston: (713) 500-1000
                                  </a>
                                </div>

                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+12109048000" style="color:white; font-size:12px; text-decoration:none;">
                                    San Antonio: (210) 904-8000
                                  </a>
                                </div>
                              </td>

                              <!-- FLORIDA COLUMN -->
                              <td style="vertical-align: top; padding-left: 12px;">
                                <div id="floridaHeading" style="color:#000; font-weight:bold; font-size:18px; margin-bottom:6px;">
                                  Florida
                                </div>
                                <div style="margin-top:4px; display:flex; align-items:flex-start; white-space:nowrap;">
                              <img src="https://img.icons8.com/ios-filled/20/ffffff/marker.png" width="14" height="14" alt="Location" style="margin-right:2px; border:0; margin-top:2px;">
                              <div style="display:flex; flex-direction:column;">
                                <a href="https://www.google.com/maps/place/Team+Enoch:+Electric,+Plumbing,+Air,+Roofing/@32.763454,-97.1586546,17z/..." target="_blank" style="color:white; font-size:12px; text-decoration:none;">
                                  3950 Anchuca Dr Bay 4, Lakeland,
                                </a>
                                <a href="https://www.google.com/maps/place/Team+Enoch:+Electric,+Plumbing,+Air,+Roofing/@32.763454,-97.1586546,17z/..." target="_blank" style="color:white; font-size:12px; text-decoration:none;">
                                  FL 33811
                                </a>
                              </div>
                            </div>

                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+14073368000" style="color:white; font-size:12px; text-decoration:none;">
                                    Orlando: (407) 336-8000
                                  </a>
                                </div>

                                <div style="margin-top:4px; white-space:nowrap;">
                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/phone.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:2px; border:0; display:inline-block;">
                                  <a href="tel:+18134368000" style="color:white; font-size:12px; text-decoration:none;">
                                    Tampa: (813) 436-8000
                                  </a>
                                </div>
                              </td>
                            </tr>
                          </table>
                          
                       </div>
                    </td>
                    <td style="vertical-align: middle;  width:280px;">
                        <table style="border-collapse: collapse; width: 100%;">
                            <!-- QR Code Section -->
                            <tr>
                                <td style="text-align: center; padding-bottom: 5px;">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://teamenoch.com" style="width: 100px; height: 100px; background: white; padding: 2px; border-radius: 8px; display: block; margin: 0 auto;">
                                    <div style="color: white; font-size: 11px; margin-top: 5px; font-weight: bold;">Scan for Contact</div>
                                </td>
                            </tr>
                          
                            <tr>
                                <td style="padding-bottom: 3px;">
                                    <table style="border-collapse: collapse;">
                                        <tr>
                                            <td style="width:24px; min-width:24px; text-align:center; vertical-align:top; color:white; font-size:12px; padding-right:10px;">
                                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/new-post.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:1px; border:0; display:inline-block;"></td>
                                            <td> <a href="mailto:mail@teamenoch.com" style="color: white; font-size: 12px; text-decoration: none;" id = "s_email">mail@teamenoch.com</a></td>
                                           
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                           <tr>
                                <td style="padding-bottom: 3px;">
                                    <table style="border-collapse: collapse;">
                                        <tr>
                                            <td style="width:24px; min-width:24px; text-align:center; vertical-align:top; color:white; font-size:12px; padding-right:10px;">
                                                  <img src="https://img.icons8.com/ios-filled/20/ffffff/globe.png" width="14" height="14" alt="Phone" style="vertical-align:middle; margin-right:1px; border:0; display:inline-block;"></td>
                                            <td> <a href="www.teamenoch.com" style="color: white; font-size: 12px; text-decoration: none;" >www.teamenoch.com</a></td>
                                           
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<div style="margin-top: 20px; display: flex; gap: 10px;">
  <button onclick="copyVisualSignature()" style="flex: 1;">
     Copy Signature for Email
  </button>
  <button onclick="copyHTMLCode()" style="flex: 1; background: #6366f1;">
   Copy HTML Code
  </button>
</div>

<div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb;">
  <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">HTML Code</h3>
  <p style="font-size: 13px; color: #666; margin-bottom: 10px;">Copy this code and paste it into your email client's signature settings:</p>
  <textarea id="htmlCodeOutput" readonly style="width: 100%; height: 200px; font-family: monospace; font-size: 11px; padding: 12px; border: 1.5px solid #d0d5dd; border-radius: 8px; background: #f9fafb; resize: vertical; margin-bottom: 10px;"></textarea>
 
</div>

</div>
</div>
</div>
</div>

<!-- <script src="script.js"></script> -->
<script>
const sigOuter = document.getElementById("sigOuter");
const sigCard = document.getElementById("sigCard");

const s_name = document.getElementById("s_name");
const s_title = document.getElementById("s_title");
const s_phone_card = document.getElementById("s_phone_card");
const s_email_card = document.getElementById("s_email_card");
const s_email = document.getElementById("s_email");
const s_img = document.getElementById("s_img");

function formatPhone(input) {
  let digits = input.value.replace(/\D/g, '').slice(0, 10);

  if (digits.length >= 6) {
    input.value = `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
  } else if (digits.length >= 3) {
    input.value = `(${digits.slice(0,3)}) ${digits.slice(3)}`;
  } else {
    input.value = digits;
  }
}
  
let uploadedPhotoURL = null;
let uploadedBgImageURL = null;

function generateVCard(name, email, phone, address, title, company) {
  const cleanPhone = phone.replace(/\D/g, '');
  
const vCard = `BEGIN:VCARD
VERSION:3.0
FN:${name}
N:${name.split(' ').reverse().join(';')};;;
ORG:${company}
TITLE:${title}
TEL;TYPE=CELL:${cleanPhone}
EMAIL:${email}
ADR;TYPE=WORK:;;${address};;;;
URL:https://teamenoch.com
END:VCARD`;
  
  return encodeURIComponent(vCard);
}

// Listen for when user selects a photo
document.getElementById("img").addEventListener("change", async function(e) {
  const file = e.target.files[0];
  
  if (!file) return;
  
  const statusDiv = document.getElementById("uploadStatus");
  statusDiv.innerHTML = '<span style="color: #ff9800;">⏳ Uploading photo...</span>';
  
  // Create FormData
  const formData = new FormData();
  formData.append('photo', file);
  
  try {
    // Upload to your API
    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData
    });

    

    const data = await response.json();
    
    if (data.success) {
      uploadedPhotoURL = data.url; // Store the URL
      s_img.src = data.url;
      statusDiv.innerHTML = '<span style="color: #4CAF50;"> Photo uploaded successfully!</span>';
      updateHTMLCodeDisplay(); 
    } else {
      statusDiv.innerHTML = '<span style="color: #f44336;">✗ Upload failed: ' + data.message + '</span>';
      uploadedPhotoURL = null;
    }
  } catch (error) {
     // Fallback: use local preview
  const reader = new FileReader();
  reader.onload = function(e) {
    uploadedPhotoURL = e.target.result;
    s_img.src = e.target.result; // Update image immediately
    statusDiv.innerHTML = '<span style="color: #4CAF50;"> Photo loaded (local preview)</span>';
    updateHTMLCodeDisplay();
  };
    reader.readAsDataURL(file);

  }
});

async function fetchUserData() {
  const emailInput = document.getElementById("email").value.trim().toLowerCase();

  if(!emailInput) {
    showError("Please enter an email address");
    return;
  }
  showLoading(true);
  try{
    const response = await fetch("./output.json");
    if (!response.ok) throw new Error("unable to load user data");

    const users = await response.json();

    const user = users.find(
      u => u.email.toLowerCase() === emailInput
    );
    if(!user) {
      showError("no user found for this email");
      showLoading(false);
      return;
    }
    populateSignatureFromUser(user);
    showLoading(false);
  } catch (err) {
    showError("Error fetching user data");
    showLoading(false);
  }
}

function showLoading(show) {
  document.getElementById("loadingStatus").style.display = show ? "block" : "none";
  document.getElementById("errorStatus").style.display = "none";
}
function showError(message) {
  document.getElementById("errorMessage").textContent = message;
  document.getElementById("errorStatus").style.display = "block";
}

function populateSignatureFromUser(user) {
    s_name.textContent = user.name || "Test Name";

  const jobTitleContainer = document.getElementById("jobTitleContainer");
  const jobTitleInput = document.getElementById("jobTitleInput");
  
  // Check if user has a job title
  if (user.jobTitle && user.jobTitle.trim() !== "") {
    // User has job title - hide the input field
    jobTitleContainer.style.display = "none";
    s_title.textContent = user.jobTitle;
  } else {
    // User doesn't have job title - show the input field
    jobTitleContainer.style.display = "block";
    jobTitleInput.value = ""; // Clear any previous value
    s_title.textContent = "Job Title";
  }

  if(user.directNumber) {
    s_phone_card.textContent = user.directNumber;
    s_phone_card.href = "tel:" + user.directNumber.replace(/\D/g,"");
  }
  s_email_card.textContent = user.email;
  s_email_card.href = "mailto:" + user.email;

  // Store user data for QR code generation
  window.currentUser = user;

  document.getElementById("signatureWrapper").style.display = "block";

  updateQRCodeFromUser(user);
  updateHTMLCodeDisplay();
}

function updateQRCodeFromUser(user) {
  if (!user.name || !user.email || !user.directNumber) return;

  const vCard = `BEGIN:VCARD
VERSION:3.0
FN:${user.name}
N:${user.name.split(" ").reverse().join(";")};;;
ORG:Team Enoch
TITLE:${user.jobTitle || ""}
TEL;TYPE=CELL:${user.directNumber.replace(/\D/g, "")}
EMAIL:${user.email}
URL:https://teamenoch.com
END:VCARD`;

  const encodedVCard = encodeURIComponent(vCard);

  const qrImg = document.querySelector('img[src*="qrserver"]');
  if (qrImg) {
    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodedVCard}`;
  }
}

// Listen for when user selects a background image
document.getElementById("bgImageInput").addEventListener("change", async function(e) {
  const file = e.target.files[0];
  
  if (!file) return;
  
  const statusDiv = document.getElementById("bgUploadStatus");
  statusDiv.innerHTML = '<span style="color: #ff9800;">⏳ Uploading background image...</span>';
  
  // Create FormData
  const formData = new FormData();
  formData.append('photo', file);
  
  try {
    // Upload to your API
    const response = await fetch('/api/upload', {
      method: 'POST',
      body: formData
    });
    
    const data = await response.json();
    
    if (data.success) {
      uploadedBgImageURL = data.url; // Store the URL
      statusDiv.innerHTML = '<span style="color: #4CAF50;"> Background uploaded successfully!</span>';
      
      applyBackgroundImage(data.url);
      updateHTMLCodeDisplay();
      
    } else {
      statusDiv.innerHTML = '<span style="color: #f44336;">✗ Upload failed: ' + data.message + '</span>';
      uploadedBgImageURL = null;
    }
  } catch (error) {
    statusDiv.innerHTML = '<span style="color: #f44336;">✗ Upload failed: ' + error.message + '</span>';
    uploadedBgImageURL = null;
  }
});

function liveUpdateSignature() {

  const nameVal = document.getElementById("name").value.trim();
  const titleVal = document.getElementById("title").value.trim();
  const phoneVal = document.getElementById("phone").value.trim();
  const emailVal = document.getElementById("email").value.trim();

  const select = document.getElementById("address");
  const selectedAddress = select.options[select.selectedIndex];

    // Update name
  s_name.textContent = nameVal || "John Doe";

    // Update title
  s_title.textContent = titleVal || "Job Title";

  //update phone
  if (phoneVal) {
    s_phone_card.textContent = phoneVal;
    s_phone_card.href = "tel:" + phoneVal.replace(/\D/g, '');
  } else {
    s_phone_card.textContent = "(123) 456-7890";
    s_phone_card.href = "tel:+11234567890";
  }
  //update email
  if (emailVal) {
    s_email_card.textContent = emailVal;
    s_email_card.href = "mailto:" + emailVal;
  }else {
    s_email_card.textContent = "email@example.com";
    s_email_card.href = "mailto:email@example.com";
  }
  //update address

  if (selectedAddress && selectedAddress.value) {
    s_address.textContent = selectedAddress.value;
    s_address.href = selectedAddress.getAttribute("data-link");
  }else {
    s_address.textContent = "Select an address";
    s_address.href = "#";
  }

    updateQRCode();
    updateHTMLCodeDisplay(); 
}


function updateHTMLCodeDisplay() {
  const signatureTable = document.querySelector('#signatureWrapper table');
  const htmlCodeOutput = document.getElementById('htmlCodeOutput');
  
  if (signatureTable && htmlCodeOutput) {
    htmlCodeOutput.value = signatureTable.outerHTML;
  }
}

function copyHTMLCode() {
  const htmlCodeOutput = document.getElementById('htmlCodeOutput');
  
  if (!htmlCodeOutput) {
    alert('HTML code not found!');
    return;
  }
  // Select the text
  htmlCodeOutput.select();
  htmlCodeOutput.setSelectionRange(0, 99999); // For mobile devices
  
  try {
    document.execCommand('copy');
    alert('✓ HTML code copied to clipboard!\n\nYou can now paste it into your email client signature settings.');
  } catch (err) {
    alert('Failed to copy. Please try again.');
  }
}

async function copyVisualSignature() {
  const signatureTable = document.querySelector('#signatureWrapper table');
  
  if (!signatureTable) {
    alert('Signature not found! Please generate a signature first.');
    return;
  }

  try {
    const signatureHTML = signatureTable.outerHTML;
    
    // Create a ClipboardItem with HTML
    const htmlBlob = new Blob([signatureHTML], { type: 'text/html' });
    const textBlob = new Blob([signatureHTML], { type: 'text/plain' });
    
    const clipboardItem = new ClipboardItem({
      'text/html': htmlBlob,
      'text/plain': textBlob
    });
    
    await navigator.clipboard.write([clipboardItem]);
    
    alert('✓ Signature copied!\n\nYou can now:\n1. Open your email client\n2. Go to signature settings\n3. Paste (Ctrl+V or Cmd+V)\n\nThe formatted signature will be pasted directly!');
    
  } catch (err) {
    // Fallback for browsers that don't support ClipboardItem
    console.error('Clipboard API failed:', err);
    
    // Try the old method
    const tempTextarea = document.createElement('textarea');
    tempTextarea.value = signatureTable.outerHTML;
    tempTextarea.style.position = 'fixed';
    tempTextarea.style.opacity = '0';
    document.body.appendChild(tempTextarea);
    tempTextarea.select();
    
    try {
      document.execCommand('copy');
      alert('✓ Signature HTML copied!\n\nPaste it into your email signature settings.');
    } catch (err2) {
      alert('❌ Failed to copy. Please use the "Copy HTML Code" button instead.');
    }
    
    document.body.removeChild(tempTextarea);
  }
}

["name", "title", "phone", "email", "address"].forEach(id => {
  const el = document.getElementById(id);
  if (el) {
    el.addEventListener("input", liveUpdateSignature);
    el.addEventListener("change", liveUpdateSignature);
  }
});

function updateSignatureColorsAndFont() {
  const fontSizeName = document.getElementById("fontSizeName").value + "px";
  const fontSizeContact = document.getElementById("fontSizeContact").value + "px";
  const fontColorProfile = document.getElementById("fontColorProfileText").value;
  const fontColorContact = document.getElementById("fontColorContactText").value;
  const fontColorTitle = document.getElementById("fontColorTitleText").value;
  const fontColorHeading = document.getElementById("fontColorHeadingText").value;
  const cardColor = document.getElementById("cardColorText").value;
  const cardBorder = document.getElementById("cardBorderText").value;

  // Profile section - Name only
  s_name.style.fontSize = fontSizeName;
  s_name.style.color = fontColorProfile;

  // Job Title
  s_title.style.fontSize = fontSizeName;
  s_title.style.color = fontColorTitle;

  // Personal phone and email in the card (left section)
  s_phone_card.style.fontSize = fontSizeContact;
  s_phone_card.style.color = fontColorContact;
  s_email_card.style.fontSize = fontSizeContact;
  s_email_card.style.color = fontColorContact;

  // Texas and Florida headings
  const texasHeading = document.getElementById('texasHeading');
  const floridaHeading = document.getElementById('floridaHeading');
  
  if (texasHeading) {
    texasHeading.style.color = fontColorHeading;
  }
  if (floridaHeading) {
    floridaHeading.style.color = fontColorHeading;
  }

  // ALL phone numbers in Texas and Florida sections
  const allPhoneLinks = document.querySelectorAll('a[href^="tel:"]');
  allPhoneLinks.forEach(link => {
    link.style.fontSize = fontSizeContact;
    link.style.color = fontColorContact;
  });

  // ALL email links (both in card and right section)
  const allEmailLinks = document.querySelectorAll('a[href^="mailto:"]');
  allEmailLinks.forEach(link => {
    link.style.fontSize = fontSizeContact;
    link.style.color = fontColorContact;
  });

  // Website link
  const websiteLink = document.querySelector('a[href*="teamenoch.com"]');
  if (websiteLink) {
    websiteLink.style.fontSize = fontSizeContact;
    websiteLink.style.color = fontColorContact;
  }

  // Location/address links
  const locationLinks = document.querySelectorAll('a[href*="google.com/maps"]');
  locationLinks.forEach(link => {
    link.style.fontSize = fontSizeContact;
    link.style.color = fontColorContact;
  });

  // Card background and border
  if (sigCard) {
    sigCard.style.backgroundColor = cardColor;
    sigCard.style.borderColor = cardBorder;
  }

  updateHTMLCodeDisplay();
}

function applyBackgroundColor(color) {

  sigOuter.style.backgroundImage = "none"; 
  sigOuter.style.backgroundColor = color;
  updateHTMLCodeDisplay(); 
}

const bgColorPicker = document.getElementById("bgColorPicker");
const bgColorText = document.getElementById("bgColorText");

bgColorPicker.addEventListener("input", () => {
  bgColorText.value = bgColorPicker.value;
  bgColorPicker.style.backgroundColor = bgColorPicker.value;
  applyBackgroundColor(bgColorPicker.value);
});

bgColorText.addEventListener("input", () => {
  const val = bgColorText.value.trim();
  if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
    bgColorPicker.value = val;
    bgColorPicker.style.backgroundColor = val;
    applyBackgroundColor(val);
  }
});

function applyBackgroundImage(imageUrl) {
  
  sigOuter.style.backgroundColor = ""; // Clear color
  sigOuter.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${imageUrl}')`;
  sigOuter.style.backgroundSize = "cover";
  sigOuter.style.backgroundRepeat = "no-repeat";
  sigOuter.style.backgroundPosition = "center";
  updateHTMLCodeDisplay();
}

function syncColor(pickerId, textId) {
  const picker = document.getElementById(pickerId);
  const text = document.getElementById(textId);

  picker.addEventListener("input", () => {
    text.value = picker.value;
    picker.style.backgroundColor = picker.value; // Update box background
    updateSignatureColorsAndFont();
  });

  text.addEventListener("input", () => {
    if (/^#[0-9A-Fa-f]{6}$/.test(text.value)) {
      picker.value = text.value;
      picker.style.backgroundColor = text.value; // Update box background
      updateSignatureColorsAndFont();
    }
  });
}

syncColor("fontColorProfilePicker", "fontColorProfileText");
syncColor("fontColorContactPicker", "fontColorContactText");
syncColor("fontColorTitlePicker", "fontColorTitleText");
syncColor("fontColorHeadingPicker", "fontColorHeadingText");
syncColor("cardColorPicker", "cardColorText");
syncColor("cardBorderPicker", "cardBorderText");
// syncColor("bgColorPicker", "bgColorText")

// Font size controls
document.getElementById("fontSizeName").addEventListener("input", updateSignatureColorsAndFont);
document.getElementById("fontSizeContact").addEventListener("input", updateSignatureColorsAndFont);

const bgTypeRadios = document.querySelectorAll('input[name="bgType"]');
const bgColorControls = document.getElementById("bgColorControls");
const bgImageControls = document.getElementById("bgImageControls");

bgTypeRadios.forEach(radio => {
  radio.addEventListener("change", () => {

    if (radio.value === "color" && radio.checked) {
      bgColorControls.style.display = "block";
      bgImageControls.style.display = "none";

      applyBackgroundColor(bgColorText.value);
    }

    if (radio.value === "image" && radio.checked) {
      bgColorControls.style.display = "none";
      bgImageControls.style.display = "block";


      if (uploadedBgImageURL) {
        applyBackgroundImage(uploadedBgImageURL);
      }
    }
  });
});
// Set initial background colors for color pickers
document.getElementById("fontColorProfilePicker").style.backgroundColor = "#ffffff";
document.getElementById("fontColorContactPicker").style.backgroundColor = "#ffffff";
document.getElementById("fontColorTitlePicker").style.backgroundColor = "#000000";
document.getElementById("fontColorHeadingPicker").style.backgroundColor = "#000000";
document.getElementById("cardColorPicker").style.backgroundColor = "#1a1a1a";
document.getElementById("cardBorderPicker").style.backgroundColor = "#111111";
document.getElementById("bgColorPicker").style.backgroundColor = "#737578";

window.addEventListener('DOMContentLoaded', function() {
  updateHTMLCodeDisplay();
});

// Listen for manual job title input
document.getElementById("jobTitleInput").addEventListener("input", function() {
  const manualJobTitle = this.value.trim();
  
  if (manualJobTitle) {
    s_title.textContent = manualJobTitle;
    
    // Update QR code with manual job title
    if (window.currentUser) {
      window.currentUser.jobTitle = manualJobTitle;
      updateQRCodeFromUser(window.currentUser);
    }
  } else {
    s_title.textContent = "Job Title";
  }
  
  updateHTMLCodeDisplay();
});
</script>
</body>
</html>
